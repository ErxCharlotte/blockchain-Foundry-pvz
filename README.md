# PvZNFT

Users can mint NFTs, which represent different types of plants with different attibutes. Users can then use the NFTs they own to participate in games and fight with Zombies.

Frontend: Nextjs
Backend: nodejs + mongoDB
Contract: Solidity foundry
Package management tool: yarn/npm

## Commands

### Deploy locally

run

```shell
anvil
```

to start a local node and start a new terminal while keeping the first one running

then run

```shell
make deploy-anvil
```

to deploy the contracts on the local node

then run

```shell
make start-interface
```

to start interact with the game

## TODOs

1. Implement game-logic.js, which starts the game, allow players to play with their own NFTs and verify the the provided NFTs
2. Write tests
3. Front-end
4. NFT trading
5. security
6. what if many people accessing the minting function, there would be many request for random number, how to mange and make sure the request is correctly handled
7. has problem dealing with randomNumberGenerator locally
8. Nouce problem might need to maintain local counter in database

// TODO: use next.js to build a simple front end
// TODO: quickly learn golang and rust

## Take-aways:

1. function returns of solidiy is in the form of storing address, need to .toString() to convert to actual value
2. block.timestamp can get current time
3. vm.warp can set timestamp, vm.roll can change block number. It is good practice to vm.warp(block.timestamp + <whatever operations>; vm.roll(block.numer + 1);)
4. Solidity cannot interact with external file system, so nft cannot be mint in real time, but can be pre-build and transfer to player.
5. concurrent style is different

## Sturcture:

<details>
<summary>Legacy Content ver.2</summary>
PlantFactory (a contract):

1. takes an IPFS URI and mints plant
2. takes a tokenId, identify the owner
3. handle trades of NFT between users

GameCore (back end):

1. Print out the board and relevant information (Sunlight amount, health of plants and zombies)
2. Ask user for an action, currently the action would be indicating a plantNFT to be placed at a position
3. Check the validity of the coordinate and the validity of the NFT (ensure it exist and is owned by this acount)
4. Deploy the plantNFT
5. Spawn zombies if condition met (certain round passed)
6. Process plant actions and update board accordingly
7. Process zombie actions and update borad accoridngly
8. Check if game ended
9. End turn

UserManager (back end):

1. connect wallets and assign user id
2. Mint NFTs and keep a lists of NFT they own
   a. Ask what types of plant users would like to mint
   b. get random number from contract and generate random attributes of plants
   c. store the NFT id under the user
3. Trade interface
4. start game interface
   a. generate random attribute and write into JSON file
   b. upload the JSON file to IPFS system and obtain the IPFS URI

UserInterface (front end):
use user's wallet to identify users and keep track of their properties

1. connect wallets and assign user id
2. Mint NFTs interface and keep a lists of NFT they own
   a. Ask what types of plant users would like to mint
   b. store the NFT id under the user
3. Trade interface
4. start game interface
   a. generate random attribute and write into JSON file
   b. upload the JSON file to IPFS system and obtain the IPFS URI

PlantData
a json file specify what attribute to be generated according to the type of plants

UserAccount
a json file recoridng user id and the NFTs they owned

</details>

<details>
<summary>Legacy Content ver.1</summary>

update:
since solidity does not have the ability to interact with external file systems, the random numbers would be generated by the contract, but the plant attributes will be generated externally and pass back to the contract to mint NFT

but since s.sol scripts cannot interact with IPFS as well, at this stage, the URI will be hard coded into the code.

PlantFactory:

1. takes an IPFS URI and mints plant
   a. generate random attribute and write into JSON file
   b. upload the JSON file to IPFS system and obtain the IPFS URI
   c. mint NFT and obtain the NFT id
2. takes a tokenId, identify the owner
3. handle trades of NFT between users

UserInterface:
use user's wallet to identify users and keep track of their properties

1. connect wallets and assign user id
2. Mint NFTs interface and keep a lists of NFT they own
   a. Ask what types of plant users would like to mint
   b. store the NFT id under the user
3. Trade interface
4. start game interface

PlantData
a json file specify what attribute to be generated according to the type of plants

UserAccount
a json file recoridng user id and the NFTs they owned

Start game

1. Print out the board and relevant information (Sunlight amount, health of plants and zombies)
2. Ask user for an action, currently the action would be indicating a plantNFT to be placed at a position
3. Check the validity of the coordinate and the validity of the NFT (ensure it exist and is owned by this acount)
4. Deploy the plantNFT
5. Spawn zombies if condition met (certain round passed)
6. Process plant actions and update board accordingly
7. Process zombie actions and update borad accoridngly
8. Check if game ended
9. End turn
</details>
